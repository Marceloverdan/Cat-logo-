<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Express - Carrinho WhatsApp</title>
    <style>
        :root {
            --primary: #25d366;
            --dark: #128c7e;
            --bg: #f0f2f5;
            --white: #ffffff;
            --text: #333;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; }
        body { background-color: var(--bg); color: var(--text); padding-bottom: 80px; }
        header { background: var(--dark); color: white; padding: 1rem; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        
        /* Painel Admin */
        #admin-panel { background: var(--white); padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { margin-bottom: 15px; font-size: 1.2rem; border-left: 4px solid var(--primary); padding-left: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .btn { border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        .btn-add { background: var(--primary); color: white; margin-top: 10px; }
        .btn-add:hover { background: var(--dark); }
        
        /* Preview Imagem */
        #preview { width: 100%; height: 200px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; border-radius: 8px; overflow: hidden; background: #fafafa; }
        #preview img { max-width: 100%; max-height: 100%; object-fit: cover; }

        /* Grid de Produtos */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .product-card { background: var(--white); border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; position: relative; }
        .product-img { width: 100%; height: 150px; object-fit: cover; background: #eee; }
        .product-info { padding: 10px; flex-grow: 1; }
        .product-name { font-weight: bold; font-size: 0.95rem; margin-bottom: 5px; }
        .product-desc { font-size: 0.8rem; color: #666; height: 32px; overflow: hidden; margin-bottom: 8px; }
        .product-price { color: var(--dark); font-weight: bold; font-size: 1.1rem; }
        .btn-cart { background: #e7f3ff; color: #007bff; border: 1px solid #007bff; margin-top: 10px; font-size: 0.8rem; padding: 8px; }
        .btn-del { position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.7); color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; }

        /* Carrinho Flutuante */
        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--white); padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; z-index: 200; }
        .btn-whatsapp { background: var(--primary); color: white; text-decoration: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        
        .hidden { display: none !important; }
        #toggle-admin { margin-bottom: 15px; background: #666; color: white; font-size: 0.8rem; padding: 5px; width: auto; }
    </style>
</head>
<body>

<header>
    <h1>Catálogo Digital</h1>
</header>

<div class="container">
    <button id="toggle-admin" class="btn" onclick="toggleAdmin()">Modo Vendedor (Cadastrar)</button>

    <div id="admin-panel" class="hidden">
        <h2>Cadastrar Novo Produto</h2>
        <div class="form-group">
            <label>Foto do Produto</label>
            <input type="file" id="file-input" accept="image/*" onchange="previewImage(event)">
            <div id="preview"><span>Clique para selecionar foto</span></div>
        </div>
        <div class="form-group">
            <label>Nome do Produto</label>
            <input type="text" id="prod-name" placeholder="Ex: Camiseta Branca">
        </div>
        <div class="form-group">
            <label>Descrição (será gerada ou digite)</label>
            <textarea id="prod-desc" rows="2" placeholder="Ex: Tecido 100% algodão, tamanho G"></textarea>
        </div>
        <div class="form-group">
            <label>Preço (R$)</label>
            <input type="number" id="prod-price" step="0.01" placeholder="0.00">
        </div>
        <button class="btn btn-add" onclick="addProduct()">Salvar no Catálogo</button>
    </div>

    <h2>Produtos</h2>
    <div id="products-grid" class="products-grid">
        </div>
</div>

<div class="cart-bar" id="cart-bar">
    <div>
        <strong id="cart-count">0</strong> itens no carrinho<br>
        <span id="cart-total">Total: R$ 0,00</span>
    </div>
    <a href="#" class="btn-whatsapp" onclick="sendWhatsApp(event)">
        Enviar p/ WhatsApp
    </a>
</div>

<script>
    let products = JSON.parse(localStorage.getItem('catalog_products')) || [];
    let cart = [];
    let currentImageBase64 = "";

    function toggleAdmin() {
        const panel = document.getElementById('admin-panel');
        panel.classList.toggle('hidden');
        const btn = document.getElementById('toggle-admin');
        btn.innerText = panel.classList.contains('hidden') ? 'Modo Vendedor (Cadastrar)' : 'Fechar Editor';
    }

    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function() {
            const output = document.getElementById('preview');
            output.innerHTML = `<img src="${reader.result}">`;
            currentImageBase64 = reader.result;
            
            // Simulação de escrita automática de descrição
            const nameField = document.getElementById('prod-name');
            const descField = document.getElementById('prod-desc');
            if(!nameField.value) {
                descField.value = "Produto de excelente qualidade. Verifique a disponibilidade de cores e tamanhos.";
            }
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function addProduct() {
        const name = document.getElementById('prod-name').value;
        const desc = document.getElementById('prod-desc').value;
        const price = document.getElementById('prod-price').value;

        if (!name || !price || !currentImageBase64) {
            alert("Preencha nome, preço e tire uma foto!");
            return;
        }

        const product = {
            id: Date.now(),
            name,
            desc,
            price: parseFloat(price),
            image: currentImageBase64
        };

        products.push(product);
        localStorage.setItem('catalog_products', JSON.stringify(products));
        
        // Limpar campos
        document.getElementById('prod-name').value = "";
        document.getElementById('prod-desc').value = "";
        document.getElementById('prod-price').value = "";
        document.getElementById('preview').innerHTML = "<span>Clique para selecionar foto</span>";
        currentImageBase64 = "";

        renderProducts();
        alert("Produto salvo com sucesso!");
    }

    function deleteProduct(id) {
        if(confirm("Deseja remover este produto do catálogo?")) {
            products = products.filter(p => p.id !== id);
            localStorage.setItem('catalog_products', JSON.stringify(products));
            renderProducts();
        }
    }

    function addToCart(id) {
        const prod = products.find(p => p.id === id);
        cart.push(prod);
        updateCartUI();
    }

    function updateCartUI() {
        const count = cart.length;
        const total = cart.reduce((sum, item) => sum + item.price, 0);
        document.getElementById('cart-count').innerText = count;
        document.getElementById('cart-total').innerText = `Total: R$ ${total.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
    }

    function renderProducts() {
        const grid = document.getElementById('products-grid');
        grid.innerHTML = "";

        products.forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <button class="btn-del" onclick="deleteProduct(${p.id})">×</button>
                <img src="${p.image}" class="product-img">
                <div class="product-info">
                    <div class="product-name">${p.name}</div>
                    <div class="product-desc">${p.desc}</div>
                    <div class="product-price">R$ ${p.price.toLocaleString('pt-br', {minimumFractionDigits: 2})}</div>
                    <button class="btn btn-cart" onclick="addToCart(${p.id})">+ Adicionar</button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function sendWhatsApp(e) {
        e.preventDefault();
        if (cart.length === 0) {
            alert("O carrinho está vazio!");
            return;
        }

        const phone = "27997628716";
        let message = "*Novo Pedido - Catálogo Online*\n\n";
        let total = 0;

        cart.forEach((item, index) => {
            message += `${index + 1}. *${item.name}* - R$ ${item.price.toFixed(2)}\n`;
            total += item.price;
        });

        message += `\n*Total: R$ ${total.toFixed(2)}*`;
        
        const encodedMsg = encodeURIComponent(message);
        window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${encodedMsg}`, '_blank');
    }

    // Inicialização
    renderProducts();
</script>

</body>
</html>
